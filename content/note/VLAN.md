---
title: VLAN
date: 2024-03-02T18:14:00+09:00
tags:
  - Network
  - ネスペ
---

Virtual LANはスイッチの機能。
L2とL3の接続性を拡張したのがVLAN機能で、物理的なネットワーク上で論理的に複数のネットワークを作成することができる。

## ブロードキャストドメインの分割

一つのブロードキャストドメインを複数のセグメントに分割できる。
これをL3だけでなくL2スイッチでもできる

## トラフィックの減少

通常はブロードキャストが発生して接続している機器すべてにパケットを送信するところを、同じVLANにのみ送信するためトラフィック量が減少する

## セキュリティの向上

同じ会社内でも複数の部署間で部外秘の情報がある場合などに、分割されたネットワークにはデータが転送されない。
これによりマルウェア感染などの被害も抑えられる。

## VLANの種類

### ポートVLAN

スイッチのポートによってVLANを識別する。シンプルだがスイッチの物理的な構成に依存する。

### タグVLAN

MACフレームに、VLANの識別するためのためのタグ情報を付与する方法。タグにより同じグループに所属するネットワークへフレームを転送する。
論理的な構成のため、1つのポートが複数のVLANに参加することもできる。

上限は4096まで

## 遠隔地LANの統合

遠隔地同士の接続はWANを挟むので通常はネットワークは分割されるが、同じVLAN IDに所属させることで遠隔地同士でも同じグループとして管理することができる。

### IEEE 802.1Qトンネリング

ISPがVLANを使ってネットワークを構成するときに、拠点ごとにVLANタグを設定しているとタグ数の上限にすぐに達してしまったり、組織同士でタグの重複が発生する可能性がある。
そこでISPが組織ごとに独自のVLANタグを付与する。
パケットにはISPが付与したタグと、組織が付与したタグが二重でつくことになるが、ISPには影響はない。 
こうしたISPがVLANを使って複数組織のトラフィックを処理できるようにする技術を IEEE 802.1Qトンネリング という

## 優先制御(QoS)

音声パケットやデータパケットといった異なる種類のトラフィックを分離し、競合を減らしたりパフォーマンスを向上させることができる。

特定のユーザーグループやアプリケーションに対して帯域幅を割り当てたり、優先度を設定したりすることが可能となる

### どうやって優先制御するか

タグVLANでは、イーサネットで利用するMACフレームを拡張して4オクテットの **VLANタグ** を挿入している。

VLANタグの中に12bitのVLAN IDや、3bitのCoSフィールドがある。
CoSフィールドの値1~7で、そのパケットの優先度を表す。

逆に、通常のイーサネットフレームにはCoSがないので優先制御は行えない。
