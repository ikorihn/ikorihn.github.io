---
title: BGP
date: 2024-03-20T18:44:00+09:00
tags:
  - ネスペ
---

AS(Autonomous System)間で用いられる動的ルーティングプロトコルの一つ。

[BGP とは? - ネットワークにおけるボーダーゲートウェイプロトコルの説明 - AWS](https://aws.amazon.com/jp/what-is/border-gateway-protocol/)


## ピアリング

BGP接続する相手のルータと経路情報交換を行うための論理的な接続のこと。
互いに接続して、情報を交換する。
ピアリングは組織同士の合意の元に経路情報が交換される。接続した組織同士や、その先の通信相手同士の通信を可能になる。

管理者は、特定のルーターを BGP ピアルーターまたは BGP スピーカルーターとして割り当てる。
ピアはASの境界にあるデバイスと言える。

[[OSPF Open Shortest Path First]] はマルチキャストを利用して同一セグメントの他のルータと経路情報を交換する

BGPピアを物理インターフェース同士で行う場合は特別なことは不要だが、
[[ループバックインターフェース]] を使う場合に、ルータの外部から存在がわからないためどこにどのIPアドレスがあるかわからないため、OSPFやスタティックルートを使って経路がわかるようにする。


## Path attribute

経路の属性

- `AS_PATH`  経路情報がどのASを経由してきたか。隣接するASに経路情報を広告する際に順列に追加する。iBGPでは、AS番号はすべて同じなので追加しない。
- `NEXT_HOP` 宛先ネットワークアドレスへのパケットをどのIPアドレス宛てに送るかを指定する。ASに到達するためのIPアドレスがネクストホップ。ルーティングテーブルのネクストホップと似たようなもの。eBGPピアにアドバタイズするときはNEXT_HOPアトリビュートを自分のIPアドレスにして送信し、iBGPピアにアドバタイズする時はNEXT_HOPアトリビュートを変更せずにルートを送信する。

## 最適経路選択アルゴリズム

BGPでは受信した宛先ルートをまずBGPテーブルに格納する。
これはそのままルーティングテーブルに反映されるわけではなく、あるネットワークへの経路情報を複数受け取った場合に最適なルートを1つだけ反映する。
この最適なルートを選択するアルゴリズムが最適経路選択アルゴリズム

1. LOCAL_PREFが最も大きい
1. AS_PATHの長さが最も短い
1. ORIGINの値が最も小さい
1. MEDの値が最も小さい

といったふうに上から順にみて選択する

## BGPマルチパス

トラフィックを分散する経路制御。
BGPの標準仕様では最適経路選択により1つの経路が選択される。
なお [[OSPF Open Shortest Path First]] だと標準でトラフィック分散ができる。
